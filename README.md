# 청약홈런(Server)

> 2023.03. - 현재
>
> 팀프로젝트(기획자1 , 디자이너1, 개발자1)

<img src="README.assets/2P_ 홈화면.png" alt="2P_ 홈화면" style="zoom:25%;" />

## 🛠 Skills

- Flutter, Dart
- Node.js , TypeScript
- Firebase



## **🏠서비스 내용**

주택 청약에 대한 커뮤니티 모바일 애플리케이션 입니다.

현재 제공하려는 핵심 기능은 다음과 같습니다.

1. **분양공고** : 한국 부동산원에서 제공하는 분양 공고 API를 이용하여 분양 공고를 제공하고, 현장리뷰, 댓글 등의 커뮤니티 기능을 제공
2. **청약자격진단** : 사용자가 자신의 상황을 입력하여 현재 청약별로 자격을 진단
3. **분양뉴스** : 크리에이터가 분양 관련 뉴스를 제작하여 업로드하고, 좋아요, 댓글 등의 커뮤니티 기능을 제공
4. **청약길잡이** : 크리에이터가 청약 제도 관련 글을 업로드하고, , 좋아요, 댓글 등의 커뮤니티 기능을 제공

## 💡 개발 내용

### FirebaseStorageCacheService

Firebase storage에서 동일한 이미지를 접근 할 때 마다 매번 다운로드 받아 비용이 증가하는 문제를 해결하기 위해 구현하였습니다.

- 작동
  1. firebase storage에서 이미지를 가져올 때, 서비스를 통해 메모리와 로컬 저장소에 이미지가 있는지 먼저 확인하고, 있으면 캐쉬에서, 없으면 storage에서 이미지를 가져옵니다.
  2. 캐쉬에 있는 경우에도 storage의 파일 메타데이터와 비교하여 캐쉬에 저장된 이미지가 최신이 아니라면 storage에서 가져옵니다.
  3. 가져온 이미지를 캐쉬로 저장할 때에는 파일 경로와 함께 가져온 시각을 저장하고, 메모리에도 이미지를 저장합니다.
  4. 메모리에 일정 값 이상의 이미지가 쌓이면 메모리 캐쉬 이미지는 삭제합니다.
- 효과
  - 이미지 리소스 다운로드 수 : n → 1
  - 메모리 캐싱으로 인한 이미지 로딩 속도 상승

### FirestorePagination

Firestore에서 컬렉션의 변화를 감지하기 위해 snapshot을 구독하면 컬렉션의 모든 문서를 한번씩 읽게 되는데, 이러한 비용 낭비를 개선하고자 snapshot에 대한 업로드 date 기반 페이지네이션을 구현하였습니다.

- 작동
  1. FirestorePagination는 시작 date와 페이징 간격을 입력 받아 그에 맞춰 firestore의 컬렉션을 간격에 따라 페이징하여 페이징 유닛을 생성합니다.
  2. 사용자가 문서 n개의 snapshot을 요청하면, 보유한 페이징 유닛에서 snapshot을 가져옵니다.
  3. 보유한 페이징 유닛이 충분한 snapshot을 보유하지 않은 경우, 요청한 snapshot의 개수를 만족 할 때까지 페이징 유닛을 생성하여 snapshot을 반환합니다.
- 효과
  - 분양 공고에서 snapshot을 구독할 때의 문서 읽기 비용이 대폭 줄어듬
  - 페이지네이션에 snapshot의 변화 감지 기능을 결합 할 수 있게 됨

### 중복 불가능한 좋아요 및 싫어요 기능

Firestore의 doc id를 이용하여 적은 수의 읽기로 좋아요와 싫어요의 중복이 불가능 하도록 구현하였습니다. 또한, firebase의 인증 기능과 트랜잭션을 활용하여 좋아요 및 싫어요 집계를 serverless 방식으로 구현 하였습니다.

### 소셜로그인

네이버와 카카오의 Aceesss Token을 이용하여 소셜 로그인을 구현하였습니다. 사용자가 token과 소셜로그인 제공자를 서버(Firebase functions)로 전달하면, 서버에서 token을 이용하여 각 제공업체의 API를 이용하여 사용자의 정보를 가져온 후, 이를 바탕으로 회원가입을 진행하고 custom token으로 Firebase 인증과 연동하였습니다.





## 깃허브 링크

https://github.com/JioBani/homerun : 클라인언트

https://github.com/JioBani/homrun-functions : 서버